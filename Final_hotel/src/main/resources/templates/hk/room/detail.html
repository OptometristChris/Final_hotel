<!DOCTYPE html>
<html lang="ko" 
      xmlns:th="http://www.thymeleaf.org"
      th:replace="~{js/layout/layout_main :: layout(~{::title}, ~{::link}, ~{::style}, ~{::script}, ~{::content})}">
<head>
<meta charset="UTF-8">
<title>객실 상세</title>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">

<style>
.container {
    max-width: 1100px;
    margin: 80px auto;
}

/* ===== 캐러셀 이미지 박스 ===== */
.carousel-img-box {
    width: 100%;
    height: 500px;              /* 높이 고정 */
    background: #f3f1ed;        /* 호텔 느낌 배경 */
    display: flex;
    align-items: center;
    justify-content: center;
}

.carousel-img-box img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;        /* 잘리지 않게 */
}

/* 텍스트 영역 */
.room-name {
    font-size: 34px;
    font-weight: 600;
    text-align: center;     /* ⭐ 가운데 정렬 */
    margin-bottom: 40px;
    letter-spacing: -0.5px;
}

.info {
    margin-top: 10px;
    font-size: 18px;
}

.price {
    font-size: 24px;
    font-weight: bold;
    margin-top: 20px;
}
</style>
</head>

<body>
<div th:fragment="content" style="margin-top:140px;">

<div class="container">

	<div class="room-name" th:text="${room.room_name}"></div>

	<div id="roomCarousel" class="carousel slide" data-ride="carousel">

    <div class="carousel-inner">

        <div class="carousel-item"
             th:each="img, stat : ${imageList}"
             th:classappend="${stat.index == 0} ? ' active'">

            <div class="carousel-img-box">
                <img th:src="@{${img}}">
            </div>

        </div>

    </div>

    <a class="carousel-control-prev"
       href="#roomCarousel"
       role="button"
       data-slide="prev">
        <span class="carousel-control-prev-icon"></span>
    </a>

    <a class="carousel-control-next"
       href="#roomCarousel"
       role="button"
       data-slide="next">
        <span class="carousel-control-next-icon"></span>
    </a>

</div>
	

    <div class="info">
        등급: <span th:text="${room.room_grade}"></span>
    </div>

    <div class="info">
        침대 타입: <span th:text="${room.bed_type}"></span>
    </div>

    <div class="info">
        전망: <span th:text="${room.view_type}"></span>
    </div>

   <div class="price">
	    <span class="detail-price"
	          th:attr="data-base-price=${room.base_price}">
	        ₩ <span th:text="${room.base_price}"></span>
	    </span>
	</div>

    <div style="margin-top:30px;">
        <a href="javascript:history.back()">← 목록으로</a>
    </div>
	
</div>

<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>


<script>
/* 통화 변경시 환율 적용 */
document.addEventListener("DOMContentLoaded", function(){

    console.log("상세페이지 로드됨");

    let exchangeRates = { KRW: 1 };
    let currentCurrency = localStorage.getItem("currency") || "KRW";

    function convertPrice(price){
        const rate = exchangeRates[currentCurrency] || 1;

        let converted = price;

        if(currentCurrency !== "KRW"){
            converted = price * rate;
        }

        return new Intl.NumberFormat('ko-KR', {
            style: 'currency',
            currency: currentCurrency
        }).format(converted);
    }

    function applyCurrency(){
        const el = document.querySelector(".detail-price");
        if(!el) return;

        const base = Number(el.dataset.basePrice);
        el.innerText = convertPrice(base);
    }

    fetch("https://open.er-api.com/v6/latest/KRW")
        .then(res => res.json())
        .then(data => {
            exchangeRates = data.rates;
            exchangeRates["KRW"] = 1;

            applyCurrency();
        });

});
</script>

</div>
</body>
</html>