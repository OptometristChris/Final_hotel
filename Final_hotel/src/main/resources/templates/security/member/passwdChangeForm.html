<!DOCTYPE html>
<html th:replace="~{layout/layout_main :: layout(~{::title}, ~{::link}, ~{::style}, ~{::script}, ~{::div.container})}"
      lang="ko"
      xmlns:th="http://www.thymeleaf.org">

<head>
<meta charset="UTF-8">
<title>비밀번호 변경</title>

<link rel="stylesheet" href="">

<style>
  :root{
    --bg: #f6f1ea;
    --panel: #ffffff;
    --line: #eadfd3;
    --line-2: #d8c6b3;
    --text: #2a2320;
    --muted: #7a6a61;
    --brand: #8b6a52;
    --accent: #cda57a;
    --danger: #c94b4b;
    --shadow: 0 18px 45px rgba(54, 38, 25, .10);
    --radius: 18px;
  }
  *{ box-sizing: border-box; }
  body{
    margin:0;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", Arial, "Apple SD Gothic Neo", sans-serif;
    background: radial-gradient(1200px 600px at 20% 10%, #fff, transparent 55%),
                radial-gradient(900px 500px at 80% 90%, #fff, transparent 50%),
                var(--bg);
    color: var(--text);
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:28px 14px;
  }
  .wrap{ width: 420px; max-width: 100%; }
  .brandbar{ display:flex; justify-content:center; margin-bottom: 14px; letter-spacing:.14em; font-weight: 800; color: var(--brand); }
  .card{ background: var(--panel); border: 1px solid var(--line); border-radius: var(--radius); box-shadow: var(--shadow); overflow:hidden; }
  .header{ padding: 20px 18px 12px; text-align:center; border-bottom: 1px solid var(--line); background: linear-gradient(180deg, #fff, #fff7ef); }
  .header h1{ margin:0; font-size: 20px; letter-spacing:.04em; }
  .header p{ margin: 6px 0 0; color: var(--muted); font-size: 13px; }
  .body{ padding: 18px; }

  .field{ margin-bottom: 12px; }
  .label{ display:flex; align-items:center; justify-content:space-between; margin-bottom: 6px; font-size: 13px; color: var(--muted); font-weight: 700; }
  .input{ width:100%; padding: 12px 12px; border: 1px solid var(--line-2); border-radius: 12px; outline:none; background: #fff; font-size: 14px; transition: border-color .15s, box-shadow .15s; }
  .input:focus{ border-color: var(--accent); box-shadow: 0 0 0 4px rgba(205,165,122,.22); }

  .hint{
    font-size: 12.5px;
    color: var(--muted);
    line-height: 1.55;
    background: #fffaf5;
    border: 1px solid var(--line);
    border-radius: 12px;
    padding: 10px;
    margin-bottom: 12px;
  }

  .btn{ width:100%; border:0; border-radius: 14px; padding: 12px 14px; font-weight: 900; cursor:pointer; background: linear-gradient(180deg, var(--brand), #6f513f); color:#fff; letter-spacing: .04em; }
  .btn:active{ transform: translateY(1px); }

  .error{ display:none; margin-top: 10px; font-size: 12.5px; color: #fff; background: var(--danger); border-radius: 12px; padding: 10px 10px; line-height: 1.45; }
  .error.show{ display:block; }

  .links{ margin-top: 12px; display:flex; justify-content:center; gap:12px; flex-wrap:wrap; color: var(--muted); font-size: 12.5px; }
  .links a{ color: var(--muted); text-decoration:none; border-bottom: 1px dashed transparent; }
  .links a:hover{ color: var(--brand); border-bottom-color: rgba(139,106,82,.5); }
</style>

<script th:inline="javascript">
/*<![CDATA[*/
document.addEventListener('DOMContentLoaded', () => {

  const frm = document.getElementById('passwdChangeFrm');
  const err = document.getElementById('err');
  const btn = document.getElementById('btnPwdChange');

  function show(msg){
    err.textContent = msg;
    err.classList.add('show');
  }

  function submitChange(){
    err.classList.remove('show');

    const passwd = frm.passwd.value.trim();
    const passwd2 = frm.passwd2.value.trim();

    const regExp = new RegExp(/^.*(?=^.{8,15}$)(?=.*\d)(?=.*[a-zA-Z])(?=.*[^a-zA-Z0-9]).*$/g);

    if(!regExp.test(passwd)){
      return show("새비밀번호는 숫자/영문자/특수문자가 혼합된 8~15자리 이내이어야 합니다.");
    }
    if(passwd !== passwd2){
      return show("새비밀번호 입력값이 다릅니다.");
    }

    frm.action = /*[[@{/security/passwdChange}]]*/ 'url';
    frm.method = "post";
    frm.submit();
  }

  btn.addEventListener('click', submitChange);
  frm.passwd2.addEventListener('keydown', (e) => {
    if(e.key === 'Enter'){ submitChange(); }
  });
});
/*]]>*/
</script>

<body>
<div class="container">
  <div class="wrap">
    <div class="brandbar">CIEL</div>

    <section class="card" aria-label="비밀번호 변경 카드">
      <div class="header">
        <h1>비밀번호 변경</h1>
        <p>새 비밀번호를 입력해주세요.</p>
      </div>

      <div class="body">
        <div class="hint">
          비밀번호 규칙: <b>숫자/영문자/특수문자 포함</b>, <b>8~15자리</b>
        </div>

        <form id="passwdChangeFrm" name="passwdChangeFrm">
          <div class="field">
            <div class="label"><span>새 비밀번호</span></div>
            <input class="input" type="password" name="passwd" id="passwd" autocomplete="new-password" placeholder="새 비밀번호" />
            <input type="hidden" name="memberid" th:value="${session.sessionMemberDTO.memberid}" />
          </div>

          <div class="field">
            <div class="label"><span>비밀번호 확인</span></div>
            <input class="input" type="password" name="passwd2" id="passwd2" autocomplete="new-password" placeholder="비밀번호 확인" />
          </div>

          <button class="btn" type="button" id="btnPwdChange">변경하기</button>

          <div class="error" id="err"></div>

          <div class="links">
            <a th:href="@{/security/member/mypage}">마이페이지</a>
            <span>|</span>
            <a th:href="@{/index}">메인</a>
          </div>
        </form>
      </div>
    </section>
  </div>
</div>
</body>
</html>