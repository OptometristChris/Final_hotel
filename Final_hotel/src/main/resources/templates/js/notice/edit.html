<!DOCTYPE html>
<html th:replace="~{js/layout/layout_main :: layout(~{::title}, ~{::link}, ~{::style}, ~{::script}, ~{::div.container})}" 
      lang="ko" 
      xmlns:th="http://www.thymeleaf.org"> 

<head>
<meta charset="UTF-8">
<title>공지사항 수정</title>

<link rel="stylesheet" href="">

<style type="text/css">
    #notice_container { padding-top: 50px; margin-bottom: 50px; }
    .table th { width: 15%; background-color: #DDDDDD; vertical-align: middle; text-align: center; }
</style>

<script th:inline="javascript">
 /*<![CDATA[*/
     const contextPath = /*[[@{/}]]*/ '';
     
     $(function(){
        var obj = [];
        
        // 스마트에디터 설정
        nhn.husky.EZCreator.createInIFrame({
            oAppRef: obj,
            elPlaceHolder: "content",
            sSkinURI: contextPath + "smarteditor/SmartEditor2Skin.html",
            htParams : {
                bUseToolbar : true,            
                bUseVerticalResizer : true,
                bUseModeChanger : true,
            }
        }); 

        // 수정 버튼 클릭 이벤트
        $("#btnEdit").click(function(){
            // 에디터 내용 반영
            obj.getById["content"].exec("UPDATE_CONTENTS_FIELD", []);
            
            // 제목 검사
            const title = $('input:text[name="title"]').val().trim();
            if(title == "") {
                alert("제목을 입력하세요!!");
                return;
            }

            // 내용 검사 (보내주신 유효성 검사 로직 적용 가능)
            let content_val = $("textarea[name='content']").val().trim();
            if(content_val == "" || content_val == "<p>&nbsp;</p>" || content_val == "<p><br></p>") {
                alert("내용을 입력하세요!!");
                return;
            }

            if(confirm("정말로 수정하시겠습니까?")) {
                const frm = document.forms['editFrm'];
                frm.method = "post";
                frm.action = contextPath + "notice/edit";
                frm.submit();   
            }
        });
     });
 /*]]>*/    
</script>

<body>
  <div class="container" id="notice_container">
      <h2 class="mb-4">공지사항 수정</h2>
      
      <form name="editFrm">
         <input type="hidden" name="noticeId" th:value="${notice.noticeId}" />
         
         <table class="table table-bordered">
            <tr>
                <th>지점</th>
                <td>
                    <select name="fkHotelId" class="form-select" style="width: 200px;">
                        <option value="1" th:selected="${notice.fkHotelId == 1}">호텔 시엘 (본점)</option>
                        <option value="2" th:selected="${notice.fkHotelId == 2}">르 시엘 (프리미엄)</option>
                    </select>
                </td>
            </tr>
            <tr>
                <th>상단고정</th>
                <td>
                    <input type="checkbox" name="isTop" value="Y" th:checked="${notice.isTop == 'Y'}" /> 
                    <small class="text-muted">(체크 시 목록 최상단에 노출됩니다.)</small>
                </td>
            </tr>
            <tr>
                <th>제목</th>
                <td>
                    <input type="text" name="title" class="form-control" th:value="${notice.title}" maxlength="200" />
                </td>
            </tr>
            <tr>
                <th>내용</th> 
                <td>
                    <textarea style="width: 100%; height: 500px;" name="content" id="content" th:text="${notice.content}"></textarea> 
                </td>
            </tr>
         </table>
                    
        <div class="text-center mt-4">
            <button type="button" class="btn btn-primary px-4 mr-2" id="btnEdit">수정완료</button>
            <button type="button" class="btn btn-secondary px-4" 
                    th:onclick="|location.href='@{/notice/detail/{id}(id=${notice.noticeId}, hotelId=${hotelId})}'|">취소</button>
        </div>
     </form>
  </div>
</body>
</html>