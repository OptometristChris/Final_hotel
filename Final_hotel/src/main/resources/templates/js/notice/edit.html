<!DOCTYPE html>
<html th:replace="~{js/layout/layout_main :: layout(~{::title}, ~{::link}, ~{::style}, ~{::script}, ~{::div.container})}" 
      lang="ko" 
      xmlns:th="http://www.thymeleaf.org"> 

<head>
    <meta charset="UTF-8">
    <title>CIEL HOTEL - 공지사항 수정</title>

    <link rel="stylesheet" href="">

    <style type="text/css">
        #notice_container { padding-top: 150px; margin-bottom: 50px; max-width: 1100px; }
        .table th { width: 15%; background-color: #F8F9FA; vertical-align: middle; text-align: center; font-weight: 600; }
        .edit-title { font-size: 2rem; font-weight: 700; margin-bottom: 40px; text-align: center; letter-spacing: 1px; }
        .btn-group-wrap { margin-top: 40px; gap: 10px; }
    </style>

    <script type="text/javascript" th:src="@{/smarteditor/js/HuskyEZCreator.js}" charset="utf-8"></script>

    <script th:inline="javascript">
     /*<![CDATA[*/
         const contextPath = /*[[@{/}]]*/ '';
         
         $(function(){
            var obj = [];
            
            // 스마트에디터 초기화 함수 정의
            function initEditor() {
                if (typeof nhn !== 'undefined' && nhn.husky && nhn.husky.EZCreator) {
                    nhn.husky.EZCreator.createInIFrame({
                        oAppRef: obj,
                        elPlaceHolder: "content",
                        sSkinURI: contextPath + "smarteditor/SmartEditor2Skin.html",
                        htParams : {
                            bUseToolbar : true,            
                            bUseVerticalResizer : true,
                            bUseModeChanger : true,
                            fOnAppLoad : function(){
                                // textarea의 값을 에디터에 주입
                                const contentValue = $("#content").val();
                                obj.getById["content"].exec("SET_CONTENTS", [contentValue]);
                            }
                        }
                    });
                } else {
                    console.error("스마트에디터 라이브러리(nhn)를 찾을 수 없습니다. 경로를 확인하세요.");
                }
            }

            // 초기화 호출
            initEditor();

            // 수정완료 버튼 클릭 이벤트
            $("#btnEdit").click(function(){
                // 에디터의 내용을 textarea에 동기화
                if(obj.length > 0 || obj.getById["content"]) {
                    obj.getById["content"].exec("UPDATE_CONTENTS_FIELD", []);
                }
                
                // 제목 유효성 검사
                const title = $('input:text[name="title"]').val().trim();
                if(title == "") {
                    alert("제목을 입력하세요!!");
                    return;
                }

                // 내용 유효성 검사 (HTML 태그를 제외한 실제 텍스트가 있는지 확인)
                let content_val = $("textarea[name='content']").val();
                let check_val = content_val.replace(/<[^>]*>?/g, '').replace(/\&nbsp;/g, '').trim();

                if(check_val == "") {
                    alert("내용을 입력하세요!!");
                    return;
                }

                if(confirm("정말로 수정하시겠습니까?")) {
                    const frm = document.forms['editFrm'];
                    frm.method = "post";
                    frm.action = contextPath + "notice/edit";
                    frm.submit();   
                }
            });
         });
     /*]]>*/    
    </script>
</head>

<body>
  <div class="container" id="notice_container">
      <h2 class="edit-title">공지사항 수정</h2>
      
      <form name="editFrm" id="editFrm">
         <input type="hidden" name="noticeId" th:value="${notice.noticeId}" />
         
         <table class="table table-bordered">
            <tr>
                <th>지점 선택</th>
                <td>
                    <select name="fkHotelId" class="form-select" style="width: 250px;">
                        <option value="1" th:selected="${notice.fkHotelId == 1}">호텔 시엘 (본점)</option>
                        <option value="2" th:selected="${notice.fkHotelId == 2}">르 시엘 (프리미엄)</option>
                    </select>
                </td>
            </tr>
            <tr>
                <th>상단 고정</th>
                <td>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" name="isTop" id="isTop" value="Y" th:checked="${notice.isTop == 'Y'}" />
                        <label class="form-check-label" for="isTop">목록 최상단에 고정 노출합니다.</label>
                    </div>
                </td>
            </tr>
            <tr>
                <th>공지 제목</th>
                <td>
                    <input type="text" name="title" class="form-control" th:value="${notice.title}" maxlength="200" placeholder="제목을 입력하세요" />
                </td>
            </tr>
            <tr>
                <th>공지 내용</th> 
                <td>
                    <textarea style="width: 100%; height: 500px;" name="content" id="content" th:text="${notice.content}"></textarea> 
                </td>
            </tr>
         </table>
                    
        <div class="d-flex justify-content-center btn-group-wrap">
            <button type="button" class="btn btn-dark px-5" id="btnEdit">수정완료</button>
            <button type="button" class="btn btn-outline-secondary px-5" 
                    th:onclick="|location.href='@{/notice/detail/{id}(id=${notice.noticeId}, hotelId=${hotelId})}'|">취소</button>
        </div>
     </form>
  </div>
</body>
</html>