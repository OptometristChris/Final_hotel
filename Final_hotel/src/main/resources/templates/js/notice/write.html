<!DOCTYPE html>
<html lang="ko" 
      xmlns:th="http://www.thymeleaf.org"
      th:replace="~{js/layout/layout_main :: layout(~{::title}, ~{::link}, ~{::style}, ~{::script}, ~{::div#notice_container})}">

<head>
<meta charset="UTF-8">
<title>공지사항 작성</title>

<link rel="stylesheet" href="">

<style type="text/css">
    /* 헤더와 겹치지 않도록 상단 여백 추가 */
    #notice_container { 
        padding-top: 130px !important; 
        margin-bottom: 50px;
    }
    .table th { width: 15%; background-color: #f8f9fa; vertical-align: middle; text-align: center; }
    .write-title { font-weight: bold; color: #333; margin-bottom: 30px; }
    .select-hotel { width: 250px; }
</style>

<script type="text/javascript" th:src="@{/smarteditor/js/HuskyEZCreator.js}" charset="utf-8"></script>

<script th:inline="javascript">
 /*<![CDATA[*/
     $(function(){
        // ==== 스마트 에디터 초기화 ====
        var obj = [];
        const sSkinURI = /*[[@{/smarteditor/SmartEditor2Skin.html}]]*/ "";
           
        nhn.husky.EZCreator.createInIFrame({
            oAppRef: obj,
            elPlaceHolder: "content", 
            sSkinURI: sSkinURI,
            htParams : {
                bUseToolbar : true,            
                bUseVerticalResizer : true,    
                bUseModeChanger : true,
            },
            fCreator: "createInIFrame"
        }); 
        
        // 등록 버튼 클릭
        $("#btnWrite").click(function(){
            // 에디터 내용 반영
            obj.getById["content"].exec("UPDATE_CONTENTS_FIELD", []);

            const title = $('input:text[name="title"]').val().trim();
            if(title == "") {
                alert("제목을 입력하세요!");
                return;
            }
            
            let content_val = $("textarea[name='content']").val();
            // 스마트에디터 빈값 체크용 (태그 제외)
            let check_val = content_val.replace(/<[^>]*>?/g, '').replace(/\s/gi, '').replace(/&nbsp;/gi, '');
          
            if(check_val.length == 0) {
                alert("내용을 입력하세요!");
                return;
            }
            
		//	[추가] isTop 체크박스 처리 (Y/N 제약조건 대응)
		   	const isTopChecked = $("#isTop").is(":checked");
		   	if(!isTopChecked) {
		       	// 체크가 안 되어 있다면 'N' 값을 가진 hidden input을 폼에 추가
		       	$('<input>').attr({
		           	type: 'hidden',
		           	name: 'isTop',
		           	value: 'N'
		       	}).appendTo('form[name="noticeFrm"]');
		       
		       	// 기존 체크박스는 전송되지 않도록 name 속성 일시 제거
		       	$("#isTop").removeAttr("name");
		   	}
            
            if(confirm("공지사항을 등록하시겠습니까?")) {
                const frm = document.noticeFrm;
                frm.method = "post";
                frm.action = /*[[@{/notice/write}]]*/ "/notice/write";
                frm.submit();                        
            }
        });
     });
 /*]]>*/    
</script>
</head>

<body>
  <div class="container" id="notice_container">
    <div class="row">
      <div class="col-12">
          <h2 class="write-title"><i class="bi bi-pencil-square"></i> 공지사항 작성</h2>
          
          <form name="noticeFrm">
             <table class="table table-bordered shadow-sm">
                 <tr>
                    <th>지점 선택</th>
                    <td>
                        <select name="fkHotelId" class="form-select select-hotel">
                            <option value="1" th:selected="${hotelId == 1}">호텔 시엘 (본점)</option>
                            <option value="2" th:selected="${hotelId == 2}">르 시엘 (프리미엄)</option>
                        </select>
                    </td>
                 </tr>
                 <tr>
                    <th>상단 고정</th>
                    <td>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="isTop" value="Y" id="isTop">
							<label class="form-check-label" for="isTop">공지사항 리스트 상단 고정</label>
                        </div>
                    </td>
                 </tr>
                 <tr>
                    <th>제목</th>
                    <td>
                        <input type="text" name="title" class="form-control" placeholder="제목을 입력하세요." />
                    </td>
                 </tr>
                 <tr>
                    <th>내용</th> 
                    <td>
                        <textarea style="width: 100%; height: 500px;" name="content" id="content"></textarea>
                    </td>
                 </tr>
            </table>
                    
            <div class="text-center my-5">
                <button type="button" class="btn btn-primary btn-lg px-5 me-2" id="btnWrite">등록</button>
                <button type="button" class="btn btn-outline-secondary btn-lg px-5" th:onclick="|location.href='@{/notice/list}'|">취소</button>  
            </div>
         </form>
      </div>
    </div>  
  </div>
</body>
</html>